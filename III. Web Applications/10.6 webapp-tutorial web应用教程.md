10.6 webapp-tutorial web应用教程
========================

本文是一篇循序渐进介绍用 Apache Shiro 保护 web 应用程序的教程。 它假定读者已经具备了 Shiro 的入门知识,并假设至少熟悉以下两个介绍性文档:

* [Application Security with Apache Shiro](http://www.infoq.com/articles/apache-shiro)
* [Apache Shiro 10 Minute Tutorial](http://shiro.apache.org/10-minute-tutorial.html)

学习本教程应该需要45分钟到1个小时时间。 当你完成后,你将有一个很好的关于 Shiro 是如何在一个 web 应用程序的概念。

目录

Overview
Project Setup
Step 1: Enable Shiro
Step 2: Connect to a User Store
Step 3: Enable Login and Logout
Step 4: User-Specific UI Changes
Step 5: Allow Access to Only Authenticated Users
Step 6: Role-based Access Control
Step 7: Permission-based Access Control

##Overview 概述
虽然 Apache Shiro 的核心设计目标允许它被用于任何基于 java 的应用程序的安全,如命令行应用程序、服务器守护进程 ,web 应用程序,等等,本指南将专注于最常见的用例:确保 web 应用程序安全运行在一个 servlet 容器,例如 Tomcat 或 Jetty。

###Prerequisites 先决条件

以下工具将被安装在本地开发机器为了跟随本教程。

* Git(测试版 w/1.7)
* Java SDK 7
* Maven 3
* 你最喜欢的IDE,比如 IntelliJ IDEA 或 Eclipse ,甚至一个简单的文本编辑器用于查看文件和更改。

###Tutorial Format 教程格式

这是一个循序渐进的教程。 本教程,和它的所有步骤,存在Git存储库。 当你复制 git 存储库, master 分支是你的起点。 在教程的每一步都是一个独立的分支。 你可以跟随只需查看 git 分支反映本教程一步你审查

###The Application 应用程序

我们将构建的 web 应用程序是一个超级网络应用,可以作为一个起点为您自己的应用程序。 它将展示用户登录,注销,特定于用户的欢迎消息,访问控制web 应用程序的某些部分,plugglable 安全数据存储和集成。

我们将开始通过建立项目,包括构建工具和声明依赖性,以及配置 servlet的 web.xml 文件启动 web 应用程序和 Shiro 的环境。

一旦我们完成设置,我们将层的各个部分的功能,包括集成的安全数据存储,然后让用户登录,注销,访问控制。

##Project Setup项目设置

不必手动设置一个目录结构和初始基本文件,我们已为你这样做好了一个 git 存储库。

###1. Fork the tutorial project 先fork本教程项目

在 github，浏览[ tutorial project ](https://github.com/lhazlewood/apache-shiro-tutorial-webapp) 项目,点击 Fork 按钮

###2. Clone your tutorial repository 复制教程存储库

现在您已经将项目 fork 在你的 GitHub 帐户,克隆它在本地机器上:

>$ git clone git@github.com:$YOUR_GITHUB_USERNAME/apache-shiro-tutorial-webapp.git    

(其中 $YOUR_GITHUB_USERNAME 是你的 GitHub 用户名)


用 cd 进入本地的项目目录查看项目结构:

>$ cd apache-shiro-tutorial-webapp

###3. Review project structure 审查项目结构

当前项目结构为：

	apache-shiro-tutorial-webapp/
	  |-- src/
	  |  |-- main/
	  |    |-- resources/
	  |      |-- logback.xml
	  |    |-- webapp/
	  |      |-- WEB-INF/
	  |        |-- web.xml
	  |      |-- home.jsp
	  |      |-- include.jsp
	  |      |-- index.jsp
	  |-- .gitignore
	  |-- .travis.yml
	  |-- LICENSE
	  |-- README.md
	  |-- pom.xml

解释下：

* pom.xml :Maven 项目/构建文件。 它有Jetty 配置,这样你就可以马上运行 mvn jetty:run 测试您的 web 应用程序运行。
* README.md :一个简单的项目的自述文件
* LICENSE :该项目是 Apache 2.0 许可协议
* .travis.yml :一个 [Travis CI](https://travis-ci.org/) 配置文件以确保它总是在项目构建时，持续运行集成构建您的项目。
* .gitignore :一个 git 忽略文件,包含的后缀和目录是那些不应该纳入到版本控制中。
* src/main/resources/logback.xml:一个简单的 [Logback](http://logback.qos.ch/) 配置文件。 对于本教程,我们选择 [SLF4J](http://www.slf4j.org/) 的日志 API 和 Logback 日志的实现。 这可能很容易被熟悉 Log4J 或者 JUL 的人所接受。
* src/main/webapp/WEB-INF/web.xml :最初的 web.xml 文件,我们将配置很快使用Shiro。
* src/main/webapp/include.jsp :一个页面,其中包含常见的引入和声明,包括其他的JSP页面。 这让我们在一个地方来管理引入和声明。
* src/main/webapp/home.jsp :应用的简单的默认主页。 包括 include.jsp (如将其他人,因为我们很快就会看到)。
* src/main/webapp/index.jsp :默认站点索引页面-这仅仅是将请求转发给我们 home.jsp 主页。

###4. Run the webapp 运行

运行

>$ mvn jetty:run 

打开浏览器访问 [localhost:8080](http://localhost:8080/),页面将会输出 Hello, World! 

按`ctl-C` (或者 mac 中的 `cmd-C`) 来关闭应用

##Step 1: Enable Shiro 启动 shiro

我们最初的 master 库 只是一个简单的通用的 web 应用程序,可以作为任何应用程序的模板。 让我们添加的最低限度,启动 Shiro web 应用程序。

执行以下git checkout 命令加载 Step1 分支:

>$ git checkout step1

检出的分支，有两点变化

1. 添加了一个 src/main/webapp/WEB-INF/shiro.ini 文件
2. src/main/webapp/WEB-INF/web.xml 改变了.

###1a: Add a shiro.ini file

可以配置 Shiro 在许多不同的方式在一个web应用程序,这取决于您所使用的web和/或MVC框架。 例如,您可以通过Spring配置Shiro,Guice,Tapestry,和许多更多。

为了简单起见,我们将启动一个Shiro环境使用Shiro的默认值(非常简单的) INI-based配置 。

如果你签出 Step1 分支,您将看到这个新的的内容 src / main / webapp / web - inf / shiro.ini 文件(简短标题删除注释):



*译者注*：参考：[http://shiro.apache.org/webapp-tutorial.html](http://shiro.apache.org/webapp-tutorial.html)